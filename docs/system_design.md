# 日報記録システム 設計図（Version 1.1 / Markdown対応）

---

## 1. システム概要

本システムは、Excel を用いて「商品／半製品の作業日報」を入力し、  
DB シートに記録・管理し、未完了作業や履歴管理、修正管理を行う仕組みである。

主な特徴：

- 商品／半製品で入力項目が切り替わる  
- 工程・作業者はチェックボックスで複数選択  
- 数量・単位・歩留まり・主作業時間などの計算ロジック  
- DB への新規登録／未完了登録／修正登録  
- 未完了一覧の生成と呼び出し  
- 履歴スライド（最新10件）  
- 履歴から修正モードへ復元  
- GitHub 連携によるコード管理

---

## 2. Input シート仕様

### 2.1 入力項目（B2〜B37）

| セル | 内容 |
|------|------|
| B2   | 作業日 |
| B3   | 種類（商品／半製品） |
| B8   | 商品名 |
| B9   | 半製品名 |
| B10〜D11 | 作業者チェックボックス |
| A15〜C19 | 商品工程チェックボックス |
| B21  | 半製品工程 |
| B23  | 数量 |
| C23  | 単位 |
| D23  | 歩留まり（半製品のみ） |
| B24〜B28 | 準備・主作業・掃除時間 |
| B29  | 平均重量 |
| B31〜B37 | メモ類 |

---

### 2.2 商品モード

- 工程は複数選択  
- 歩留まりなし  
- 主作業時間の標準比較なし  
- 数量・単位のみ DB に登録  
- 商品名は B8

---

### 2.3 半製品モード

- 工程は単一選択（B21）  
- 歩留まり計算あり  
- 主作業時間の標準比較あり  
- ロット・平均重量も登録  
- 半製品名は B9

---

## 3. DB シート仕様（22列）

| 列 | 内容 |
|----|------|
| 1  | 種類 |
| 2  | 作業日 |
| 3  | 名称 |
| 4  | 工程 |
| 5  | 数量 |
| 6  | 単位 |
| 7  | 枚数 |
| 8  | ロット |
| 9  | 平均重量 |
| 10 | 準備時間 |
| 11 | 主作業時間 |
| 12 | 掃除時間 |
| 13 | 歩留まり |
| 14 | 歩留り評価 |
| 15 | 時間評価 |
| 16 | 評価理由 |
| 17 | 工程メモ |
| 18 | 中分類メモ |
| 19 | 種類メモ |
| 20 | 備考 |
| 21 | 登録日時 |
| 22 | 未完了フラグ |

---

## 4. DB 登録ロジック

### 4.1 新規登録

- DB の最終行＋1 に書き込む  
- 商品／半製品でロジック分岐  
- 工程は文字列化  
- 作業者は「ササモト、マセ…」形式  
- 数量はそのまま  
- 歩留まりは半製品のみ  
- 主作業時間の標準比較は半製品のみ  
- 登録日時は Now  
- 未完了フラグは空欄

---

### 4.2 未完了登録

- DB22列目に「未完」  
- 未完了一覧に表示される

---

### 4.3 修正登録

- 履歴から復元した際に Z1 に DB行番号を保存  
- 修正登録時はその行を上書き更新

---

## 5. 履歴スライド（F→O の 10 列）

### 5.1 概要

- 最新入力を F列に保存  
- 過去9件を右にスライド  
- F1〜O1 に DB行番号を保存（修正用）

---

### 5.2 保存内容

- B列の値を基本コピー  
- 作業者 → 文字列化  
- 商品工程 → 文字列化  
- 数量 → 「数量/単位/歩留まり％」形式  
- 商品名／半製品名は種類に応じて切替

---

### 5.3 修正モード

1. G1 の修正ボタンを押す  
2. G列の内容を B列に復元  
3. DB行番号を Z1 に保存  
4. 修正登録で DB を上書き

---

## 6. 未完了管理

### 6.1 未完了一覧

- DB22列目が「未完」の行を抽出  
- 作業日／種類／名称／工程／数量／ロットを表示  
- 呼び出しボタン付き

---

### 6.2 呼び出し

- DB の該当行を Input に復元  
- 修正モードと同じ仕組み

---

## 7. モジュール構成（推奨）
modules/ Module_DB.bas Module_Input.bas Module_Product.bas Module_HalfProduct.bas Module_Time.bas Module_Yield.bas Module_Utils.bas Module_History.bas
classes/ （必要に応じて追加）
forms/ （必要に応じて追加）
sheets/ Sheet1.cls Sheet2.cls ThisWorkbook.cls
docs/ system_design.md db_mapping.md

---

## 8. 関数一覧

- 作業者文字列  
- 商品工程文字列  
- 数量表示文字列  
- 主作業時間評価  
- 歩留まり評価  
- DB登録_本体  
- 履歴スライド  
- 未完了一覧生成  
- 呼び出し処理  
- 修正登録処理  

---

## 9. 今後の課題

- 商品の標準時間ロジックをどう扱うか  
- 履歴の UI 改善  
- 未完了のフィルタ強化  
- DB の検索機能  
- GitHub 自動コミットの効率化  

---
