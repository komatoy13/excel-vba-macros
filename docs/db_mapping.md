# DB マッピング定義

## 1. 全体方針

- 製品と半製品で参照するマスタを分ける  
  - 製品：T商品名テーブル  
  - 半製品：ＴＤＳテーブル  
- Input シートの B4（作業コード）をキーとして、  
  各マスタの「コード」または「記号」列からレコードを特定する。  
- マッピングは「列名ベース」で行い、列番号には依存しない。  
  列の追加・順番変更に強い構造とする。

---

## 2. Input シート → T商品名テーブル（製品）

### 2.1 キー

- Input.B4（作業コード）  
  → T商品名テーブルの「コード」列と一致する行を検索する。

### 2.2 マッピング

- Input.B5（半製品工程）  
  - 常に空欄  
  - 製品では工程を扱わない  

- Input.B6（大分類）  
  - T商品名テーブルの「中分類」  

- Input.B7（中分類）  
  - T商品名テーブルの「小分類」  

- Input.B8（詳分類）  
  - 空欄  

- Input.B9（名称）  
  - T商品名テーブルの「商品名」  

---

## 3. Input シート → ＴＤＳテーブル（半製品）

### 3.1 キー

半製品コードには複数のパターンがあるため、  
以下の順序でレコードを特定する。

1. 通常パターン  
   - Input.B4（作業コード）  
   - ＴＤＳテーブルの「記号」列と完全一致する行を検索する。  

2. イレギュラーパターン（9文字形式）  
   - Input.B4 が 9文字かつ 2文字目がハイフンの場合  
   - 先頭1文字：工程コード  
   - 3文字目以降：baseCode として扱う  
   - baseCode と ＴＤＳテーブルの「記号」列が一致する行を検索する。  

### 3.2 マッピング

- Input.B5（半製品工程）  
  - 通常パターン：ＴＤＳテーブルの「工程」  
  - イレギュラーパターン：工程コードから決定した工程名  

- Input.B6（大分類）  
  - ＴＤＳテーブルの「形状」  

- Input.B7（中分類）  
  - 通常：ＴＤＳテーブルの「色」  
  - 工程が「プリント」の場合：文字列「プリント」  

- Input.B8（詳分類）  
  - 通常：空欄  
  - 工程が「プリント」の場合：ＴＤＳテーブルの「色」  

- Input.B9（名称）  
  - ＴＤＳテーブルの「種類」  

---

## 4. 工程コード → 工程名マッピング（半製品）

イレギュラーパターンの半製品コードにおいて、  
先頭1文字の工程コードから工程名を決定する。

- f → 成型  
- c → 検品  
- h → 包装糖  
- k → カット・検品  

このマッピングは VBA 内の Select Case で実装される。

---

## 5. テーブル列名一覧

### 5.1 T商品名テーブル

- 商品名  
- 大分類  
- 中分類  
- 小分類  
- コード  
- （その他の列は現時点では使用しない）

### 5.2 ＴＤＳテーブル

- 工程  
- No.  
- 商品記号  
- 記号  
- 色  
- 形状  
- 分類  
- 種類  

---

## 6. 将来の拡張を見据えた前提

- 列名が変わらない限り、列の追加・順番変更は許容される。  
- 新しい工程や分類が追加されても、  
  ・テーブル側に列を追加  
  ・VBA 側のマッピングを最小限修正  
 で対応できる構造とする。  
- DB 側（将来の RDB やスプレッドシート）に移行する場合も、  
  このマッピング定義をそのまま移植できるようにしておく。
